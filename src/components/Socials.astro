---
import { SOCIALS } from "@/constants";
import LinkButton from "./LinkButton.astro";
---

<div class="flex flex-wrap items-center gap-1 sm:flex-nowrap relative">
  {
    SOCIALS.map(social => (
      <LinkButton
        href={social.href}
        class="p-2 hover:rotate-6 sm:p-1"
        title={social.linkTitle}
        data-social-name={social.name}
        target="_blank"
        rel="noopener noreferrer"
      >
        <social.icon class="inline-block size-6 scale-125 fill-transparent stroke-current stroke-2 opacity-90 group-hover:fill-transparent sm:scale-110" />
        <span class="sr-only">{social.linkTitle}</span>
      </LinkButton>
    ))
  }
</div>

<script>
  document.addEventListener("astro:page-load", () => {
    const socialLinks = document.querySelectorAll("[data-social-name='RSS']");

    socialLinks.forEach(link => {
      link.addEventListener("click", async (e) => {
        e.preventDefault();
        const href = link.getAttribute("href");
        if (href) {
            const url = new URL(href, window.location.origin).href;
            try {
                await navigator.clipboard.writeText(url);
                const rect = link.getBoundingClientRect();
                window.dispatchEvent(new CustomEvent("toast", { 
                    detail: { 
                        message: "RSS URL Copied!",
                        x: rect.left + rect.width / 2,
                        y: rect.top
                    } 
                }));
            } catch (err) {
                console.error("Failed to copy: ", err);
            }
        }
      });
    });
  });
</script>
